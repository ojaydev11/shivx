# ============================================================================
# PostgreSQL Client Authentication Configuration (pg_hba.conf)
# ============================================================================
# This file controls authentication for database connections
# Format: TYPE  DATABASE  USER  ADDRESS  METHOD  [OPTIONS]
# ============================================================================

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# ----------------------------------------------------------------------------
# Local Connections (Unix domain socket)
# ----------------------------------------------------------------------------

# "local" is for Unix domain socket connections only
local   all             all                                     scram-sha-256

# ----------------------------------------------------------------------------
# IPv4 Connections
# ----------------------------------------------------------------------------

# Require SSL for all TCP/IP connections
# hostssl = require SSL/TLS encryption
# hostnossl = reject non-SSL connections (commented out for backward compatibility)

# Allow SSL connections from Docker network
hostssl all             all             172.16.0.0/12           scram-sha-256

# Allow SSL connections from local network (adjust subnet as needed)
hostssl all             all             10.0.0.0/8              scram-sha-256

# Allow SSL connections from any address (production - be specific!)
hostssl all             all             0.0.0.0/0               scram-sha-256

# Reject non-SSL connections (uncomment for strict SSL enforcement)
# hostnossl all         all             0.0.0.0/0               reject

# ----------------------------------------------------------------------------
# IPv6 Connections
# ----------------------------------------------------------------------------

# IPv6 local connections
hostssl all             all             ::1/128                 scram-sha-256

# IPv6 Docker network
hostssl all             all             fd00::/8                scram-sha-256

# ----------------------------------------------------------------------------
# Replication Connections
# ----------------------------------------------------------------------------

# Allow replication connections (for streaming replication)
hostssl replication     all             172.16.0.0/12           scram-sha-256

# ----------------------------------------------------------------------------
# SECURITY NOTES
# ----------------------------------------------------------------------------
#
# 1. Authentication Methods:
#    - scram-sha-256: Most secure password authentication (recommended)
#    - md5: Legacy password authentication (less secure)
#    - trust: No password required (NEVER use in production!)
#    - cert: Certificate-based authentication
#
# 2. SSL Enforcement:
#    - Use 'hostssl' to require SSL
#    - Use 'hostnossl' to explicitly reject non-SSL (strict mode)
#    - Never use 'host' (allows both SSL and non-SSL)
#
# 3. Network Restrictions:
#    - Be specific with IP ranges
#    - Use smallest CIDR block possible
#    - Consider using 'cert' authentication for highest security
#
# 4. Testing:
#    - Test connections with: psql "postgresql://user@host:5432/db?sslmode=require"
#    - Verify SSL: SELECT ssl_is_used();
#    - Check cipher: SELECT ssl_cipher();
#
# 5. Monitoring:
#    - Enable connection logging in postgresql.conf
#    - Monitor failed authentication attempts
#    - Set up alerts for suspicious activity
#
# ============================================================================
